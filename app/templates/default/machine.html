{% extends "default/base.html" %}
{% import "default/activity_modal.html" as activity_modal %}

{% block content %}
    {% set ns = namespace(date=None) %}
    <div class="container mt-5">
        <h1 class="my-5">{{ machine.name }} - {{ date }}</h1>
        <div class="row">
            <div class="col col-8">
                <h2>Jobs</h2>
                <ul class="list-group-flush pl-0">
                    <li class="list-group-item">
                        <div class="row flex-nowrap">
                            <div class="col-3">
                                Job Number
                            </div>
                            <div class="col-1">
                                Start
                            </div>
                            <div class="col-1">
                                End
                            </div>
                            <div class="col-2">
                                Cycle (s)
                            </div>
                            <div class="col-2">
                                Good Qty
                            </div>
                            <div class="col-2">
                                Reject Qty
                            </div>
                        </div>
                    </li>

                    {% for job in jobs %}
                        <li class="list-group-item">
                            <div class="row flex-nowrap">
                                <div class="col-3">
                                    {{ job.job_number }}
                                </div>
                                <div class="col-1">
                                    {{ job.start_time.strftime("%H:%M") }}
                                </div>
                                <div class="col-1">
                                    {% if job.end_time %}
                                    {{ job.end_time.strftime("%H:%M") }}
                                    {% endif %}
                                </div>
                                <div class="col-2">
                                    {{ job.ideal_cycle_time_s }}
                                </div>
                                <div class="col-2">
                                    {{ good_production_dict[job.id] }}
                                </div>
                                <div class="col-2">
                                    {{ reject_production_dict[job.id] }}
                                </div>

                                <div class="text-right col">
                                    <button type="button" class="btn btn-dark">
                                        Edit
                                    </button>
                                </div>
                            </div>
                        </li>

                    {% endfor %}
                </ul>
            </div>
            <div class="col col-4">
                <h2>Activities</h2>

                <ul class="list-group-flush pl-0">
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col col-5">
                                Time
                            </div>
                            <div class="col col-5">
                                State
                            </div>
                        </div>
                    </li>
                    {% for act in activities %}
                        <li class="list-group-item">
                            <div class="row">
                                <div class="col col-5 flex-shrink-1">
                                    {{ act.start_time.strftime("%H:%M") }} ->
                                    {% if act.end_time %}
                                        {{ act.end_time.strftime("%H:%M") }}
                                    {% else %}
                                        now
                                    {% endif %}

                                </div>
                                <div class="col col-5">
                                    {{ act.activity_code.short_description }}
                                </div>

                                <div class="col col-2 text-right">
                                    <button type="button" class="btn btn-dark" data-toggle="modal"
                                            data-target="#editActivityModal{{ act.id }}">
                                        Edit
                                    </button>

                                    {{ activity_modal.edit_activity_modal(act, activity_form) }}
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <script>
        function putActivity(activityId, newActivityCodeId, dropdownIndex) {
            let data = {
                activity_code_id: newActivityCodeId
            }
            $.ajax({
                url: '/api/activity/' + activityId,
                type: 'PUT',
                data: JSON.stringify(data),
                contentType: "application/json",
                success: function (result) {
                    window.location.reload();
                }
            });
        }
    </script>

{% endblock %}

